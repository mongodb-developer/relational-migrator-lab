"use strict";(self.webpackChunkrelational_migrator_lab=self.webpackChunkrelational_migrator_lab||[]).push([["6742"],{2608:function(e,n,t){t.r(n),t.d(n,{default:()=>u,frontMatter:()=>s,metadata:()=>o,assets:()=>c,toc:()=>d,contentTitle:()=>l});var o=JSON.parse('{"id":"Migrate Data/monitor-cdc-migration","title":"\uD83D\uDC50 Monitor a Continuous Migration Job","description":"When a continuous migration job has completed its initial synchronization stage, it enters the Change-Data-Capture (CDC) stage.","source":"@site/docs/220-Migrate Data/40-monitor-cdc-migration.mdx","sourceDirName":"220-Migrate Data","slug":"/Migrate Data/monitor-cdc-migration","permalink":"/relational-migrator-lab/docs/Migrate Data/monitor-cdc-migration","draft":false,"unlisted":false,"editUrl":"https://github.com/mongodb-developer/relational-migrator-lab/blob/main/docs/220-Migrate Data/40-monitor-cdc-migration.mdx","tags":[],"version":"current","sidebarPosition":40,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\uD83D\uDC50 Run a Continuous Migration Job","permalink":"/relational-migrator-lab/docs/Migrate Data/cdc-migration"},"next":{"title":"\uD83E\uDDB8 Migration using CDC and Kafka","permalink":"/relational-migrator-lab/docs/Migrate Data/kafka-migration"}}'),i=t("5893"),a=t("65"),r=t("600");let s={},l="\uD83D\uDC50 Monitor a Continuous Migration Job",c={},d=[];function h(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"-monitor-a-continuous-migration-job",children:"\uD83D\uDC50 Monitor a Continuous Migration Job"})}),"\n",(0,i.jsx)(n.p,{children:"When a continuous migration job has completed its initial synchronization stage, it enters the Change-Data-Capture (CDC) stage.\nIn this stage, the source database is monitored for changes, and these changes are applied to the target MongoDB database."}),"\n",(0,i.jsx)(r.Z,{url:"http://127.0.0.1:8278",src:"img/210-image-012.png",alt:"Screenshot of the Data Migration monitoring page"}),"\n",(0,i.jsx)(n.p,{children:"To verify changes are being captured correctly, you can make changes to the Postgres library database and check MongoDB for corresponding changes."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Using pgAdmin or psql, apply the following updates to the library database in Postgres"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"GRANT USAGE ON SCHEMA library to replication_group;\n\nINSERT INTO library.authors VALUES (9999, 'Julian May', 'julianmay', 'Born in 1931, Julian May sold her first short story to John W. Campbell''s Astounding Science Fiction magazine in 1951. It was a science fiction short story called Dune Roller. But it wasn''t until the 1980s that the author returned to genre fiction, after writing a variety of non-fiction and children''s books, often under pseudonyms. May then wrote the phenomenally successful Saga of the Exiles, followed by the Galactic Milieu series. The Many-Coloured Land, book one of the Saga of the Exiles, won the Locus Best Novel Award. It was also shortlisted for top genre awards including the Hugo, the Nebula, the Prometheus Award and the Mythopoetic Fantasy Award for Adult Literature. Julian May passed away in October 2017.', NULL);\n\nINSERT INTO library.books VALUES ('1447224051', 'Jack the Bodiless', 398, 1991, 'His powers may be the ultimate hope, if they allow him to live.', '', 2, 2, 'Jack the Bodiless', NULL, NULL, 132, 19, 1);\nINSERT INTO library.books VALUES ('144722406X', 'Diamond Mask', 402, 1994, 'She concealed her great gifts, but some plans were made to be broken.', '', 2, 2, 'Diamond Mask', NULL, NULL, 132, 19, 1);\nINSERT INTO library.books VALUES ('1447224078', 'Magnificat', 434, 1996, 'A glorious future is in sight, until the rebellion brings Armageddon.', '', 2, 2, 'Magnificat', NULL, NULL, 132, 19, 1);\n\nINSERT INTO library.book_genre VALUES ('1447224051', 803);\nINSERT INTO library.book_genre VALUES ('144722406X', 803);\nINSERT INTO library.book_genre VALUES ('1447224078', 803);\n\nINSERT INTO library.author_book VALUES (9999, '1447224051');\nINSERT INTO library.author_book VALUES (9999, '144722406X');\nINSERT INTO library.author_book VALUES (9999, '1447224078');\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["If you need to install pgAdmin, it can be downloaded from ",(0,i.jsx)(n.a,{href:"https://www.pgadmin.org/download/",children:"here"})]})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["If you are taking part in an instructor led lab, you should prefix the book IDs ",(0,i.jsx)(n.code,{children:"1447224051"}),", ",(0,i.jsx)(n.code,{children:"144722406X"}),", and ",(0,i.jsx)(n.code,{children:"1447224078"})," with a unique combination of characters (try your initials), and add a random value to the author ID ",(0,i.jsx)(n.code,{children:"9999"}),", to avoid duplicate key errors with your classmates."]})}),"\n",(0,i.jsxs)(n.p,{children:["If continuous migration is operating correctly, you should see an update to the ",(0,i.jsx)(n.code,{children:"Total events seen"})," and ",(0,i.jsx)(n.code,{children:"Events in the last hour"})," counts in Relational Migrator."]}),"\n",(0,i.jsx)(r.Z,{url:"http://127.0.0.1:8278",src:"img/210-image-013.png",alt:"Screenshot of the Data Migration monitoring page"}),"\n",(0,i.jsx)(n.p,{children:"Now check for the new books in MongoDB:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["In Compass, run a search against the books collection for a books we added to Postgres: ",(0,i.jsx)(n.code,{children:"{_id: /^14472240/}"})]}),"\n",(0,i.jsx)(n.li,{children:"If the CDC process worked correctly, you should see three book documents being returned"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Screenshot of MongoDB Compass",src:t(3308).Z+"",width:"2320",height:"1428"})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"If you are taking part in an instructor led lab, modify the query to include the unique combination of characters you added to the book IDs when adding them to Postgres."})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"Note the documents added to MongoDB with a continuous migration will include some of the fields we exluded when editing the mapping rules - specifically ID fields defined in primary key / foreign key constraints in Postgres. Relational Migrator relies on these fields to be able to accurately identify documents in MongoDB when applying updates."})}),"\n",(0,i.jsx)(n.p,{children:"Now try deleting the records we just added from Postgres:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"DELETE FROM library.author_book WHERE  author_id = 9999;\nDELETE FROM library.book_genre WHERE book_id LIKE '14472240%';\nDELETE FROM library.books WHERE id LIKE '14472240%';\nDELETE FROM library.authors WHERE id = 9999;\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["If you are taking part in an instructor led lab, modify the ",(0,i.jsx)(n.code,{children:"author_id"})," and ",(0,i.jsx)(n.code,{children:"book_id"})," values to match those you used when inserting the data."]})}),"\n",(0,i.jsxs)(n.p,{children:["Check for updates to the ",(0,i.jsx)(n.code,{children:"Total events seen"})," and ",(0,i.jsx)(n.code,{children:"Events in the last hour"})," counts in Relational Migrator."]}),"\n",(0,i.jsx)(n.p,{children:"Verify the books have been deleted in MongoDB:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["In Compass, run the same search against the books collection: ",(0,i.jsx)(n.code,{children:"{_id: /^14472240/}"})]}),"\n",(0,i.jsx)(n.li,{children:"If the CDC process worked correctly, the query should not find any matching books"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Screenshot of MongoDB Compass",src:t(7251).Z+"",width:"2308",height:"1440"})}),"\n",(0,i.jsxs)(n.p,{children:["Click the ",(0,i.jsx)(n.code,{children:"Complete CDC"})," button on the the Relational Migrator Data Migration tab to end the CDC job."]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["If you close your Relational Migrator browser tab without clicking ",(0,i.jsx)(n.code,{children:"Complete CDC"}),", the CDC migration will continue to run in the background. You can end the job by either ruturning to the Relational Migrator UI, opening the project and clicking ",(0,i.jsx)(n.code,{children:"Complete CDC"})," on the data migration tab, or by exiting Relational Migrator."]})})]})}function u(e={}){let{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},3308:function(e,n,t){t.d(n,{Z:function(){return o}});let o=t.p+"assets/images/210-image-014-8fd1c2b2c2579ded317aa48924a637e3.png"},7251:function(e,n,t){t.d(n,{Z:function(){return o}});let o=t.p+"assets/images/210-image-015-47627875020cbf04f2e71c99fb6510c6.png"},600:function(e,n,t){t.d(n,{Z:()=>r});var o=t("5893");function i(e){let n=e.url||"http://localhost:3000";return(0,o.jsxs)("div",{className:"browser container",children:[(0,o.jsxs)("div",{className:"row",children:[(0,o.jsxs)("div",{className:"column left",children:[(0,o.jsx)("span",{className:"dot",style:{background:"#ED594A"}}),(0,o.jsx)("span",{className:"dot",style:{background:"#FDD800"}}),(0,o.jsx)("span",{className:"dot",style:{background:"#5AC05A"}})]}),(0,o.jsx)("div",{className:"column middle",children:(0,o.jsx)("input",{type:"text",value:n})}),(0,o.jsx)("div",{className:"column right",children:(0,o.jsxs)("div",{style:{float:"right"},children:[(0,o.jsx)("span",{className:"bar"}),(0,o.jsx)("span",{className:"bar"}),(0,o.jsx)("span",{className:"bar"})]})})]}),(0,o.jsx)("div",{className:"content",children:e.children})]})}t("7294");var a=t("3187");function r(e){return(0,o.jsx)(i,{...e,children:(0,o.jsx)("img",{src:(0,a.ZP)(e.src),alt:e.alt})})}},65:function(e,n,t){t.d(n,{Z:function(){return s},a:function(){return r}});var o=t(7294);let i={},a=o.createContext(i);function r(e){let n=o.useContext(a);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);